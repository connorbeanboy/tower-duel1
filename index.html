<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tower Duel</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
  body { margin:0; }
  canvas { display:block; margin:0 auto; }
  #hand { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); display:flex; gap:10px; }
  .card { width:60px; height:80px; background:#eee; border:2px solid #333; border-radius:8px; display:flex; justify-content:center; align-items:center; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>
<div id="hand"></div>
<script>
const config = {
    type: Phaser.AUTO,
    width: 540,
    height: 960,
    backgroundColor: '#6AB04C',
    physics: { default: 'arcade', arcade: { debug: false } },
    scene: { preload, create, update }
};
const game = new Phaser.Game(config);

let playerTower, enemyTower, projectiles, units, laneY = [380, 580];
let cards = [];
let currentCard = 0;

function preload() {
    // Load Kenney free assets (Top-Down Tanks / cartoon style)
    this.load.image('grass','https://kenney.nl/assets/tiles/kenney_tileset/tilesheet_kenney.png');
    this.load.image('bridge','https://kenney.nl/assets/topdown-tanks/tileBridgeA.png');
    this.load.image('playerTower','https://kenney.nl/assets/topdown-tanks/tankBody_green_outline.png');
    this.load.image('enemyTower','https://kenney.nl/assets/topdown-tanks/tankBody_red_outline.png');
    this.load.image('bullet','https://kenney.nl/assets/topdown-tanks/bulletLarge_outline.png');
    this.load.image('tank','https://kenney.nl/assets/topdown-tanks/tankBody_red_outline.png');
    this.load.image('archer','https://kenney.nl/assets/topdown-tanks/turretGreen_outline.png');
}

function create() {
    // Background
    this.add.rectangle(270,480,540,960,0x6AB04C); // grass
    this.add.rectangle(270,480,540,100,0x1F75FE); // river
    this.add.rectangle(140,480,60,100,0xA0522D); // left bridge
    this.add.rectangle(400,480,60,100,0xA0522D); // right bridge

    // Towers
    playerTower = this.physics.add.image(270,850,'playerTower').setScale(0.6).setImmovable(true);
    enemyTower = this.physics.add.image(270,110,'enemyTower').setScale(0.6).setImmovable(true);

    projectiles = this.physics.add.group();
    units = this.physics.add.group();

    // Cards
    const cardData = [
        {name:'Tank', type:'ground'},
        {name:'Archer', type:'ranged'},
        {name:'Bolt', type:'spell'},
        {name:'Mini', type:'ground'},
        {name:'Ice', type:'ranged'},
        {name:'Fire', type:'spell'},
        {name:'Giant', type:'ground'},
        {name:'Slinger', type:'ground'}
    ];
    const handDiv = document.getElementById('hand');
    cardData.forEach((c,i)=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerText=c.name;
        card.onclick=()=>spawnUnit(c.name);
        handDiv.appendChild(card);
        cards.push(c);
    });

    // Enemy auto-spawn for demo
    this.time.addEvent({ delay:2000, callback:spawnEnemy, callbackScope:this, loop:true });
}

function spawnUnit(name){
    const lane = laneY[Math.floor(Math.random()*laneY.length)];
    const unit = units.create(270,850,lane.includes('Tank')?'tank':'archer');
    unit.setData('target',enemyTower);
    unit.setData('speed',50);
}

function spawnEnemy(){
    const lane = laneY[Math.floor(Math.random()*laneY.length)];
    const enemy = units.create(270,110,'tank');
    enemy.setData('target',playerTower);
    enemy.setData('speed',50);
    enemy.setData('enemy',true);
}

function update(time, delta){
    units.getChildren().forEach(u=>{
        const target = u.getData('target');
        if(!target) return;
        const dir = target.y > u.y?1:-1;
        u.y += dir * u.getData('speed') * delta/1000;

        // Shoot projectile if near tower
        if(Math.abs(u.y - target.y)<50 && !u.getData('cooldown')){
            const b = projectiles.create(u.x,u.y,'bullet');
            b.setVelocityY(dir*300);
            u.setData('cooldown',true);
            setTimeout(()=>u.setData('cooldown',false),1000);
        }
    });

    // Remove offscreen projectiles
    projectiles.getChildren().forEach(p=>{
        if(p.y<0 || p.y>960) p.destroy();
    });

    // Collision
    this.physics.overlap(projectiles, [playerTower,enemyTower], (b,t)=>{ b.destroy(); });
}
</script>
</body>
</html>
