<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tower Duel</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
body { margin:0; overflow:hidden; }
canvas { display:block; margin:0 auto; background:#6AB04C; }
#hand { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); display:flex; gap:10px; }
.card { width:60px; height:80px; background:#eee; border:2px solid #333; border-radius:8px; display:flex; justify-content:center; align-items:center; font-weight:bold; cursor:pointer; }
#elixirBar { position:absolute; top:10px; left:50%; transform:translateX(-50%); width:300px; height:20px; background:#444; border:2px solid #222; border-radius:10px; }
#elixirFill { width:0%; height:100%; background:#00f; border-radius:10px; }
#message { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:32px; font-weight:bold; color:white; text-shadow:2px 2px 4px #000; display:none; }
</style>
</head>
<body>
<div id="elixirBar"><div id="elixirFill"></div></div>
<div id="hand"></div>
<div id="message"></div>
<script>
const config = {
    type: Phaser.AUTO,
    width: 540,
    height: 960,
    physics: { default:'arcade', arcade:{ debug:false } },
    scene: { preload, create, update }
};
const game = new Phaser.Game(config);

let playerTower, enemyTower, units, projectiles, bridges=[];
let elixir=10, maxElixir=10, elixirRegen=1;
let lanesY=[420,540]; 
let gameOver=false;

function preload() {
    // Kenney assets (free, hosted online)
    this.load.image('bridge','https://kenney.nl/assets/topdown-tanks/tileBridgeA.png');
    this.load.image('playerTower','https://kenney.nl/assets/topdown-tanks/tankBody_green_outline.png');
    this.load.image('enemyTower','https://kenney.nl/assets/topdown-tanks/tankBody_red_outline.png');
    this.load.image('bullet','https://kenney.nl/assets/topdown-tanks/bulletLarge_outline.png');
    this.load.image('tank','https://kenney.nl/assets/topdown-tanks/tankBody_red_outline.png');
    this.load.image('archer','https://kenney.nl/assets/topdown-tanks/turretGreen_outline.png');
    this.load.image('giant','https://kenney.nl/assets/topdown-tanks/tankBody_yellow_outline.png');
    this.load.image('wizard','https://kenney.nl/assets/topdown-tanks/turretRed_outline.png');
    this.load.image('spearman','https://kenney.nl/assets/topdown-tanks/turretBlue_outline.png');
    this.load.image('priest','https://kenney.nl/assets/topdown-tanks/turretPurple_outline.png');
    this.load.image('goblin','https://kenney.nl/assets/topdown-tanks/tankBody_gray_outline.png');
    this.load.image('cannon','https://kenney.nl/assets/topdown-tanks/turretOrange_outline.png');
}

function create() {
    const scene = this;
    // Bridges
    bridges.push(this.physics.add.staticImage(140,480,'bridge'));
    bridges.push(this.physics.add.staticImage(400,480,'bridge'));

    // Towers
    playerTower = this.physics.add.image(270,850,'playerTower').setImmovable(true);
    playerTower.hp = 100;
    enemyTower = this.physics.add.image(270,110,'enemyTower').setImmovable(true);
    enemyTower.hp = 100;

    units = this.physics.add.group();
    projectiles = this.physics.add.group();

    // Cards
    const cardData = [
        {name:'Tank', cost:3, sprite:'tank', type:'ground'},
        {name:'Archer', cost:2, sprite:'archer', type:'ranged'},
        {name:'Giant', cost:5, sprite:'giant', type:'ground'},
        {name:'Wizard', cost:4, sprite:'wizard', type:'ranged'},
        {name:'Spearman', cost:2, sprite:'spearman', type:'ground'},
        {name:'Priest', cost:3, sprite:'priest', type:'ranged'},
        {name:'Goblin', cost:1, sprite:'goblin', type:'ground'},
        {name:'Cannon', cost:4, sprite:'cannon', type:'ranged'}
    ];
    const handDiv=document.getElementById('hand');
    cardData.forEach(c=>{
        const card=document.createElement('div');
        card.className='card';
        card.innerText=c.name;
        card.onclick=()=>spawnUnit(c,false);
        handDiv.appendChild(card);
    });

    // Enemy AI spawns
    this.time.addEvent({ delay:2000, loop:true, callback:spawnEnemy, callbackScope:this });
}

function spawnUnit(card,isEnemy){
    if(gameOver) return;
    if(!isEnemy && elixir<card.cost) return;
    if(!isEnemy) elixir-=card.cost;

    const laneY = lanesY[Math.floor(Math.random()*lanesY.length)];
    const y = isEnemy ? 110 : 850;
    const unit = units.create(270,y,card.sprite);
    unit.setData('target',isEnemy?playerTower:enemyTower);
    unit.setData('lane',laneY);
    unit.setData('speed',isEnemy?60:100);
    unit.setData('cooldown',false);
    unit.setData('isEnemy',isEnemy);
    unit.setData('type',card.type);
}

function spawnEnemy(){
    const cardTypes=['tank','archer','giant','wizard','spearman','priest','goblin','cannon'];
    const choice = cardTypes[Math.floor(Math.random()*cardTypes.length)];
    spawnUnit({sprite:choice,type:'ground'},true);
}

function update(time, delta){
    if(gameOver) return;

    // Elixir regen
    elixir+=elixirRegen*delta/1000;
    if(elixir>maxElixir) elixir=maxElixir;
    document.getElementById('elixirFill').style.width=(elixir/maxElixir*100)+'%';

    units.getChildren().forEach(u=>{
        const target = u.getData('target');
        if(!target) return;

        // Move to nearest bridge first
        const bridgeX = u.x<270 ? 140 : 400;
        if(Math.abs(u.x-bridgeX)>5){
            u.x += (bridgeX-u.x)*0.05*delta;
        } else {
            // Move vertically to target
            const dir = target.y>u.y?1:-1;
            u.y += dir*u.getData('speed')*delta/1000;
        }

        // Shoot if in range
        if(Math.abs(u.y-target.y)<50 && !u.getData('cooldown')){
            const b = projectiles.create(u.x,u.y,'bullet');
            b.setVelocityY(u.getData('isEnemy')?300:-300);
            b.setData('owner',u.getData('isEnemy')?'enemy':'player');
            u.setData('cooldown',true);
            setTimeout(()=>u.setData('cooldown',false),1000);
        }
    });

    // Projectiles hit towers
    projectiles.getChildren().forEach(p=>{
        if(p.y<0 || p.y>960) { p.destroy(); return; }
        if(p.getData('owner')==='player' && Phaser.Geom.Intersects.RectangleToRectangle(p.getBounds(), enemyTower.getBounds())){
            enemyTower.hp-=5; p.destroy();
        }
        if(p.getData('owner')==='enemy' && Phaser.Geom.Intersects.RectangleToRectangle(p.getBounds(), playerTower.getBounds())){
            playerTower.hp-=5; p.destroy();
        }
    });

    // Win/lose check
    if(enemyTower.hp<=0) endGame('You Win!');
    if(playerTower.hp<=0) endGame('You Lose!');
}

function endGame(msg){
    gameOver=true;
    document.getElementById('message').innerText=msg;
    document.getElementById('message').style.display='block';
}
</script>
</body>
</html>

